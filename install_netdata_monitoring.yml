---
- name: Install netdata monitoring framework
  shell: 'bash <(curl -Ss https://my-netdata.io/kickstart.sh) --dont-wait'

- name: Set netdata to bind to localhost only
  lineinfile: path=/etc/netdata/netdata.conf regexp="bind to =.*" line="bind to = 127.0.0.1"

- name: Install nginx
  apt: name=nginx-light state=present

- name: Remove default nginx site conf
  file: path=/etc/nginx/sites-enabled/default state=absent

- name: Install nginx netdata conf
  template: src=nginx-netdata.conf.j2 dest=/etc/nginx/sites-enabled/nginx-netdata.conf mode=0755

- name: Install nginx SSL cert and key
  template: src={{ item }}.j2 dest=/etc/nginx/ssl/{{ item }} mode=0755
  with_items:
    - nginx.crt
    - nginx.key 

- name: Create nginx passwords file
  template: src=nginx-passwords.j2 dest=/etc/nginx/passwords mode=0755

- name: Restart nginx
  service: name=nginx state=restarted

